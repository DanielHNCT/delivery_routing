 REPORTE COMPLETO DEL FLUJO DE REQUESTS - APP COLIS PRIV
================================================================

Basado en el an谩lisis del archivo mas_log.log, he identificado el flujo completo 
de requests que realiza la aplicaci贸n m贸vil CP DISTRI V2 de Colis Priv茅.

 INFORMACIN GENERAL DE LA APP
================================
- Nombre: CP DISTRI V2
- Package: com.danem.cpdistriv2
- Versi贸n: 3.3.0.9 (actualizada desde 2.3.0.8)
- Dispositivo: Sony D5503 (Android 5.1.1)
- Usuario: A187518
- Sociedad: PCP0010699
- IMEI: 351680067703516

 FLUJO COMPLETO DE REQUESTS
==============================

1. INICIALIZACIN Y CONFIGURACIN (21:45:00 - 21:45:45)
========================================================

1.1 Firebase Setup
------------------
POST https://firebaseinstallations.googleapis.com/v1/projects/pdacolisnotification-prod/installations
- Configuraci贸n de notificaciones push
- Obtiene FID y refresh token

1.2 Logging y Auditor铆a
------------------------
POST https://wslog.colisprive.com/WS_Commun/ServiceWCFLogSpir.svc/REST/LogMobilite
- Registra actividad de la app
- ActivityId: 2f5b63c4-80bd-431b-b5aa-8a0d0944435a

1.3 Referencial de Clientes
----------------------------
GET https://wsreferentiel-v2.colisprive.com/WS_RefDistributeur/RefDistributeurConsolideExtranetToExterne.svc/REST/ClientExtranetlightByTypeClient?TypeClient=PRESTATAIRECOLIS
- Obtiene lista de clientes prestataires

1.4 Servicios de Google
------------------------
- POST https://in.appcenter.ms/logs (AppCenter analytics)
- GET https://app-measurement.com/config (Google Analytics)
- POST https://play.googleapis.com/log (Google Play Services)
- POST https://cloudconfig.googleapis.com/config (Google Cloud Config)

1.5 Servicios Sony
------------------
- PUT https://api-x.sonymobile.com/myxperia/cc/devices/ (MyXperia)
- POST https://api-x.sonymobile.com/oauthv2/accesstoken (OAuth Sony)

2. AUTENTICACIN PRINCIPAL (21:45:46)
======================================

2.1 Login Inicial
-----------------
POST https://wsauthentificationexterne.colisprive.com/api/auth/login/Membership

Headers:
- ActivityId: 2f5b63c4-80bd-431b-b5aa-8a0d0944435a
- UserName: PCP0010699_A187518
- Societe: PCP0010699
- Domaine: Membership

Body:
{
  "audit": {
    "appName": "CP DISTRI V2",
    "deviceModelName": "Sony D5503",
    "iccid": "indisponible",
    "imei": "351680067703516",
    "msisdn": "indisponible",
    "noSerie": "3qtg83zdy95jmczkeiyx1rfa9"
  },
  "commun": {
    "dureeTokenInHour": 0
  },
  "login": "PCP0010699_A187518",
  "password": "INTI7518",
  "societe": "PCP0010699"
}

2.2 Auditor铆a de Instalaci贸n
-----------------------------
POST https://store.colisprive.com/WebApi/STORE/API/ANDROID/application/AuditDeviceInstall
POST https://store.colisprive.com/WebApi/STORE/API/android/application/AuditInstallResult/
- Registra la instalaci贸n y resultado

2.3 Verificaci贸n de Versi贸n
---------------------------
GET https://store.hopps-group.com/WebApi/STORE/api/android/Application/com.danem.cpdistriv2/CheckVersionForUser/A187518/Version/2/3/0/8/...
GET https://store.colisprive.com/WebApi/STORE/api/android/Application/com.danem.cpdistriv2/CheckVersionForUser/A187518/Version/2/3/0/8/...
- Verifica si hay actualizaciones disponibles

2.4 Descarga de Actualizaci贸n
-----------------------------
GET https://store.colisprive.com/WebApi/STORE/API/android/application/binary/4899
- Descarga la nueva versi贸n 3.3.0.9

3. REFRESH TOKEN Y REAUTENTICACIN (21:46:24 - 21:46:26)
==========================================================

3.1 Logging con Nuevo ActivityId
--------------------------------
POST https://wslog.colisprive.com/WS_Commun/ServiceWCFLogSpir.svc/REST/LogMobilite
- Nuevo ActivityId: 523d2d46-defb-4aeb-b3fb-495e30106306

3.2 Referencial Actualizado
----------------------------
GET https://wsreferentiel-v2.colisprive.com/WS_RefDistributeur/RefDistributeurConsolideExtranetToExterne.svc/REST/ClientExtranetlightByTypeClient?TypeClient=PRESTATAIRECOLIS
- Obtiene datos actualizados con nueva versi贸n

3.3 Refresh Token
-----------------
POST https://wsauthentificationexterne.colisprive.com/api/auth/login-token

Headers:
- ActivityId: 523d2d46-defb-4aeb-b3fb-495e30106306
- VersionApplication: 3.3.0.9

Body:
{
  "dureeTokenInHour": 0,
  "token": "Xal5G2w1CDR1AMe6uElQw4TCzBkHfIf8K3QICBMQLt5SvXDNPOsNCSzJM3MRIRVTcU3LW2PAIrLzqV8bOIlPQb/AK0y8p2C3pqx1L+UfqKr+xtaL+CLk5I+i+0+XDde8QFhmMfClgZk4KZiiF9GcvRNLoIS+EnN+Xkx4s/3CqDaGGjFKf/qCkOzgAa9LwXjFSSnE/WA/gcMYGuf/Bky+tIP71vYzB1mEori0pp0jdly/gFNcEbp1q8McH1cVAYYbHKlsWiek04ypLX06WstNY6AgcaMVg3Yr7E/zVgQz5bqTPB3gSyQeU/hLasyO3pFSpPMY764oHyxImR8iwghkVD1eToHoi8WfaoVjiDSd1+k="
}

3.4 Auditor铆a Post-Actualizaci贸n
--------------------------------
POST https://store.colisprive.com/WebApi/STORE/API/ANDROID/application/AuditDeviceInstall
POST https://store.colisprive.com/WebApi/STORE/API/android/application/AuditInstallResult/
- Registra la nueva versi贸n instalada

4. OBTENCIN DE TOURNE (21:46:28)
====================================

4.1 Request Principal de Tourn茅e
--------------------------------
POST https://wstournee-v2.colisprive.com/WS-TourneeColis/api/getListTourneeMobileByMatriculeDistributeurDateDebut_POST

Headers:
- ActivityId: 523d2d46-defb-4aeb-b3fb-495e30106306
- AppName: CP DISTRI V2
- UserName: A187518
- AppIdentifier: com.danem.cpdistriv2
- Device: Sony D5503
- VersionOS: 5.1.1
- VersionApplication: 3.3.0.9
- VersionCode: 1
- Societe: PCP0010699
- Domaine: ""
- SsoHopps: [TOKEN_SSO_COMPLETO]

Body:
{
  "DateDebut": "2025-08-19",
  "Matricule": "PCP0010699_A187518"
}

4.2 Logging Post-Tourn茅e
-------------------------
POST https://wslog.colisprive.com/WS_Commun/ServiceWCFLogSpir.svc/REST/LogMobilite
- Registra la obtenci贸n exitosa de tourn茅e

5. SERVICIOS ADICIONALES (21:46:31 - 21:47:50)
===============================================

5.1 Servicio Danem
------------------
POST http://sd3.danem.fr/cpdistri/plutonservice.asmx
- SOAP request para servicio de distribuci贸n
- Login: PCP0010699_A187518;D5503
- IMEI: 351680067703516

5.2 GPS Assistance
------------------
GET http://xtra2.gpsonextra.net/xtra2.bin
- Datos de asistencia GPS

 HEADERS CLAVE IDENTIFICADOS
==============================

Headers de Autenticaci贸n:
- ActivityId: Identificador 煤nico de sesi贸n
- AppName: "CP DISTRI V2"
- UserName: Usuario autenticado
- Societe: C贸digo de sociedad
- SsoHopps: Token SSO principal
- Device: Modelo del dispositivo
- VersionApplication: Versi贸n de la app

Headers de Auditor铆a:
- AppIdentifier: Package de la app
- VersionOS: Versi贸n de Android
- VersionCode: C贸digo de versi贸n interno

 PATRONES DE ACTUALIZACIN
============================

1. Verificaci贸n de Versi贸n: La app verifica si hay actualizaciones disponibles
2. Descarga Autom谩tica: Si hay una nueva versi贸n, la descarga autom谩ticamente
3. Reinicio de Sesi贸n: Despu茅s de la actualizaci贸n, se reinicia la sesi贸n con nuevo ActivityId
4. Refresh Token: Se obtiene un nuevo token SSO para continuar operaciones

 ENDPOINTS PRINCIPALES
========================

- Autenticaci贸n: wsauthentificationexterne.colisprive.com
- Tourn茅e: wstournee-v2.colisprive.com
- Logging: wslog.colisprive.com
- Referencial: wsreferentiel-v2.colisprive.com
- Store: store.colisprive.com

 OBSERVACIONES IMPORTANTES
============================

1. Seguridad: La app usa tokens SSO complejos y ActivityId 煤nicos por sesi贸n
2. Auditor铆a: Cada acci贸n se registra con logging detallado
3. Actualizaciones: Sistema autom谩tico de actualizaci贸n con reinicio de sesi贸n
4. Compatibilidad: Soporte para Android 5.1.1 (versi贸n antigua)
5. Integraci贸n: M煤ltiples servicios integrados (Google, Sony, Danem)

================================================================
Este flujo representa el comportamiento completo de la aplicaci贸n 
m贸vil oficial de Colis Priv茅, incluyendo autenticaci贸n, 
actualizaciones autom谩ticas, y obtenci贸n de datos de tourn茅e.

Fecha de an谩lisis: 2025-08-19
Archivo analizado: mas_log.log
================================================================
